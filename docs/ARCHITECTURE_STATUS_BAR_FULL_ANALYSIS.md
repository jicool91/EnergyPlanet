–ê–†–•–ò–¢–ï–ö–¢–£–†–ê –°–¢–ê–¢–£–° –ë–ê–†–ê - –ü–û–õ–ù–´–ô –ê–ù–ê–õ–ò–ó

1. –û–ë–©–ê–Ø –ö–û–ù–¶–ï–ü–¶–ò–Ø

–°—Ç–∞—Ç—É—Å –±–∞—Ä –≤ Energy Planet ‚Äî —ç—Ç–æ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–π header, –∫–æ—Ç–æ—Ä—ã–π —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞:
- üîß Telegram safe area (–≤—ã—Ä–µ–∑—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ + —Ö—Ä–æ–º Telegram)
- üì± –†–µ–∂–∏–º—ã –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è (sheet, expanded, fullscreen)
- üé® –¢–µ–º—É Telegram (light/dark + —Ü–≤–µ—Ç–æ–≤–∞—è –ø–∞–ª–∏—Ç—Ä–∞)
- üìê –ê–∫—Ç–∏–≤–Ω—É—é –≤–∫–ª–∞–¥–∫—É (—Ä–∞–∑–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –¥–ª—è Tap vs –¥—Ä—É–≥–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤)

### –ê–Ω–∞–ª–∏–∑

- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.** Telegram Mini Apps –ø—Ä–µ–¥–ø–∏—Å—ã–≤–∞—é—Ç —É—á–∏—Ç—ã–≤–∞—Ç—å –∫–∞–∫ –∞–ø–ø–∞—Ä–∞—Ç–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã (`safeAreaInsets`), —Ç–∞–∫ –∏ `contentSafeAreaInsets`, –∞ —Ç–∞–∫–∂–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Å–º–µ–Ω—É —Å–æ—Å—Ç–æ—è–Ω–∏—è viewport (sheet ‚Üí expanded ‚Üí fullscreen) –∏ —Ç–µ–º—ã. –≠—Ç–æ –æ–ø–∏—Å–∞–Ω–æ –≤ —Ä–∞–∑–¥–µ–ª–∞—Ö viewport –∏ theme –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è.** –í `webapp/src/services/tma/viewport.ts:1-210` –∏ `webapp/src/hooks/useSafeArea.ts:1-66` –º—ã —è–≤–Ω–æ —Ä–∞–∑–¥–µ–ª—è–µ–º `safe` –∏ `content` –æ—Ç—Å—Ç—É–ø—ã, —Ç—Ä–∞–Ω—Å–ª–∏—Ä—É–µ–º –∏—Ö –≤ CSS –∏ –æ—Ç–¥–∞—ë–º –≤ layout. –¢–µ–º–∞ —á–∏—Ç–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `useTheme` (`webapp/src/hooks/useTheme.ts:1-45`). –ê–∫—Ç–∏–≤–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ–Ω—Ç–µ–Ω—Ç header-–∞ –≤ `webapp/src/App.tsx:344-420`.
- **–í—ã–≤–æ–¥.** –ö–æ–Ω—Ü–µ–ø—Ü–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ—Ñ–¥–æ–∫—É: –≤—Å–µ —á–µ—Ç—ã—Ä–µ —Å–∏–≥–Ω–∞–ª–∞ —É–∂–µ —É—á—Ç–µ–Ω—ã –∏ –∑–∞–≤–µ–¥–µ–Ω—ã –≤ –µ–¥–∏–Ω—É—é —Ç–æ—á–∫—É –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ AppLayout. –†–∏—Å–∫ ‚Äî –ø–æ—è–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Ä–µ–∂–∏–º–æ–≤ Tap/—ç–∫—Ä–∞–Ω–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –æ–±–æ–π—Ç–∏ –æ–±—â–∏–µ —Ç–æ–∫–µ–Ω—ã; –Ω—É–∂–µ–Ω –∫–æ–Ω—Ç—Ä–æ–ª—å —á–µ—Ä–µ–∑ –∫–æ–¥-—Ä–µ–≤—å—é/–¥–æ–∫.

---
2. –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –°–õ–û–ò (–°–ù–ò–ó–£ –í–í–ï–†–•)

–°–ª–æ–π 1: TMA SDK Integration (services/tma/)

core.ts ‚Äî Bootstrap Telegram Mini App SDK:
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç @tma.js/sdk
- –í—ã–∑—ã–≤–∞–µ—Ç miniApp.ready() –∏ viewport.expand()
- –û—Ç–∫–ª—é—á–∞–µ—Ç –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø –¥–ª—è fullscreen —Ä–µ–∂–∏–º–∞

viewport.ts ‚Äî Safe Area Management:
// –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:
- getTmaSafeAreaSnapshot() ‚Üí { safe: {top, right, bottom, left}, content: {...} }
- onTmaSafeAreaChange(callback) ‚Üí –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è safe area
- updateCssVariablesFromSafeArea() ‚Üí –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç --tg-safe-area-* –≤ :root

–í–∞–∂–Ω–æ! –†–∞–∑–ª–∏—á–∞–µ—Ç –¥–≤–∞ —Ç–∏–ø–∞ –æ—Ç—Å—Ç—É–ø–æ–≤:
1. safe ‚Äî —Ñ–∏–∑–∏—á–µ—Å–∫–∏–µ –≤—ã—Ä–µ–∑—ã —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ (notch, Dynamic Island)
2. content ‚Äî –æ—Ç—Å—Ç—É–ø—ã –æ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤ Telegram (–∫–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç—å, –º–µ–Ω—é)

theme.ts ‚Äî –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Ç–µ–º—ã:
- –ß–∏—Ç–∞–µ—Ç themeParams –∏–∑ Telegram
- –û–±–Ω–æ–≤–ª—è–µ—Ç CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ --tg-theme-*
- –í—ã–∑—ã–≤–∞–µ—Ç miniApp.setHeaderColor() –∏ setBackgroundColor()

### –ê–Ω–∞–ª–∏–∑

- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.** Telegram —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Mini App SDK —á–µ—Ä–µ–∑ `init()`, –≤—ã–∑—ã–≤–∞—Ç—å `miniApp.ready()`, `viewport.expand()`, –æ—Ç–∫–ª—é—á–∞—Ç—å vertical swipe –≤ fullscreen, –∞ —Ç–∞–∫–∂–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ `setHeaderColor`/`setBackgroundColor` –∏ —Å–ª—É—à–∞—Ç—å `theme_changed`.
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è.** `core.ts` –ø–æ–∫—Ä—ã–≤–∞–µ—Ç init, ready, expand –∏ `swipeBehavior.disableVertical()` (`webapp/src/services/tma/core.ts:1-90`). `viewport.ts` –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ `viewport.state` –∏ fallback-–∏—Ç –Ω–∞ `Telegram.WebApp` —Å–æ–±—ã—Ç–∏—è (`webapp/src/services/tma/viewport.ts:211-332`). `theme.ts` –º–∞–ø–∏—Ç `themeParams` –∏ –ø–∏—à–µ—Ç CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (`webapp/src/services/tma/theme.ts:1-90`).
- **–í—ã–≤–æ–¥.** –°–ª–æ–π TMA –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–∫—Ä—ã–≤–∞–µ—Ç –æ—Ñ–¥–æ–∫. –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è –¥—ã—Ä–∞ ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–∏ –ø–æ –æ—à–∏–±–∫–∞–º `setHeaderColor`/fullscreen; —Å–µ–π—á–∞—Å –µ—Å—Ç—å —Ç–æ–ª—å–∫–æ `logger.warn`, –Ω–æ –±–µ–∑ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏.

---
–°–ª–æ–π 2: React Hooks (hooks/)

useSafeArea.ts ‚Äî Reactive Safe Area:
export function useSafeArea() {
  const safeArea = useSyncExternalStore(
    subscribeSafeArea,
    getSafeAreaSnapshot,
    getSafeAreaSnapshot
  );

  return {
    safeArea: { safe, content },
    viewport: { isFullscreen, isExpanded, height },
    safeTopWithBuffer: safe.top + content.top + HEADER_BUFFER_PX,
  };
}

–ü–æ—á–µ–º—É useSyncExternalStore?
- –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ safe area
- –ò–∑–±–µ–≥–∞–µ—Ç tearing
- React 18+ –ø–∞—Ç—Ç–µ—Ä–Ω

useTheme.ts ‚Äî Reactive Theme:
export function useTheme() {
  const [theme, setTheme] = useState(getTmaThemeSnapshot());
  const isDark = colorScheme === 'dark';

  useEffect(() => {
    const unsubscribe = onTmaThemeChange(nextTheme => {
      setTheme(nextTheme);
    });
    return unsubscribe;
  }, []);

  return { theme, colorScheme, isDark };
}

### –ê–Ω–∞–ª–∏–∑

- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.** Telegram –æ–ø–∏—Å—ã–≤–∞–µ—Ç `safe_area_changed`/`viewport_changed` –∫–∞–∫ –≤–Ω–µ—à–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –∏ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏, —á—Ç–æ–±—ã –Ω–µ –¥–æ–ø—É—Å—Ç–∏—Ç—å —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–æ–≤, –∞ `theme_changed` –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –¥–ª—è —Ç—ë–º–Ω–æ–π —Ç–µ–º—ã.
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è.** `useSafeArea` –ø–æ—Å—Ç—Ä–æ–µ–Ω –Ω–∞ `useSyncExternalStore`, —á—Ç–æ –¥–∞—ë—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –¥–ª—è concurrent rendering (`webapp/src/hooks/useSafeArea.ts`). `useTheme` –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ `onTmaThemeChange` –∏ —Ö—Ä–∞–Ω–∏—Ç `isDark` (`webapp/src/hooks/useTheme.ts`). –° 2025‚Äë11‚Äë08 –æ–±–∞ hook-–∞ –ø—É–±–ª–∏–∫—É—é—Ç —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—é (`safe_area_hook_sample`, `theme_hook_update`) –∏ —Å–∫–ª–∞–¥—ã–≤–∞—é—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –≤ `window.__safeAreaStats/__themeStats`.
- **–í—ã–≤–æ–¥.** –°–ª–æ–π hooks —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–∞–∫—Ç–∏–∫–∞–º React 18, –ø–ª—é—Å —Ç–µ–ø–µ—Ä—å –ø–æ–∫—Ä—ã—Ç –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å—é. –°–ª–µ–¥–∏—Ç—å –∑–∞ —Ç–µ–º, —á—Ç–æ–±—ã —Å–æ–±—ã—Ç–∏—è –Ω–µ –∑–∞—à—É–º–ª—è–ª–∏ –∫–ª–∏–µ–Ω—Ç—Å–∫—É—é —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—é (–∏–Ω—Ç–µ—Ä–≤–∞–ª 30/60 —Å–µ–∫—É–Ω–¥ —É–∂–µ –∑–∞–ª–æ–∂–µ–Ω).

---
–°–ª–æ–π 3: Layout Component (AppLayout.tsx)

<AppLayout
  header={headerNode}
  activeTab="tap"
  tabs={NAVIGATION_TABS}
>
  {children}
</AppLayout>

–ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã:

Safe Area —Ä–∞—Å—á—ë—Ç:
const { safeTopWithBuffer, isFullscreen, safeLeft, safeRight, safeBottom } = useSafeArea();
const headerStyle = {
  paddingLeft: `${safeLeft + 16}px`,
  paddingRight: `${safeRight + 16}px`,
  paddingTop: `var(--app-header-offset-top, ${safeTopWithBuffer}px)`,
};

–ü—Ä–∏—á–∏–Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è var(--app-header-offset-top):
- CSS –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
- React —Ä–µ—Ä–µ–Ω–¥–µ—Ä –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π
- –ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –º–µ—Ä—Ü–∞–Ω–∏–µ

Fullscreen –∞–¥–∞–ø—Ç–∞—Ü–∏—è:
<header className="status-bar-shell" data-fullscreen={isFullscreen ? 'true' : 'false'}>

CSS:
.status-bar-shell {
  border: 1px solid var(--app-card-border);
  border-radius: 28px;
  background: var(--app-header-system-bg);
  box-shadow: 0 20px 45px rgba(10, 10, 10, 0.45);
  backdrop-filter: blur(24px);
}
.status-bar-shell[data-fullscreen='true'] {
  border-color: transparent;
  box-shadow: none;
  backdrop-filter: none;
  background: var(--app-header-bg);
}

Manual Close Button (Desktop):
const shouldShowManualClose = /desktop|mac|windows|web/.test(platform);
{shouldShowManualClose && (
  <button className="manual-close-button" onClick={() => miniApp.close()}>
    ‚úï
  </button>
)}

Theme Synchronization:
useEffect(() => {
  const headerColor = theme.header_color ?? theme.bg_color;
  try {
    miniApp.setHeaderColor(headerColor ?? 'bg_color');
  } catch (error) {
    window.Telegram?.WebApp?.setHeaderColor?.(headerColor);
  }
}, [theme]);

### –ê–Ω–∞–ª–∏–∑

- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.** Telegram —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç –æ—Ç–∫–ª—é—á–∞—Ç—å –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –ø—Ä–∏ fullscreen, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ `setHeaderColor`/`setBackgroundColor` –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π close, –µ—Å–ª–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∏—Å—Ç–µ–º–Ω—ã–π. –°–º. —Ä–∞–∑–¥–µ–ª—ã viewport –∏ UI controls –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è.** AppLayout –ø—Ä–∏–º–µ–Ω—è–µ—Ç CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `--app-header-offset-top` –∏ `data-fullscreen` (`webapp/src/components/layout/AppLayout.tsx:97-179`), manual close –ø–æ—è–≤–ª—è–µ—Ç—Å—è –Ω–∞ desktop (`—Å—Ç—Ä. 155-170`), –∞ `useEffect` —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç —Ü–≤–µ—Ç–∞ –∏ fallback-–∏—Ç –Ω–∞ `Telegram.WebApp` (`—Å—Ç—Ä. 46-92`).
- **–í—ã–≤–æ–¥.** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–ª–µ–¥—É–µ—Ç –æ—Ñ–¥–æ–∫—É; –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –Ω–∞–¥—ë–∂–Ω–æ—Å—Ç–∏ —Å—Ç–æ–∏—Ç –¥–µ–±–∞—É–Ω—Å–∏—Ç—å –≤—ã–∑–æ–≤ `setHeaderColor` –∏ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–∫–∞–∑ `miniApp.close()` –≤ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—é.

---
–°–ª–æ–π 4: Header Content (App.tsx)

Tap Screen header:
<Surface tone="overlayMedium" border="subtle" elevation="strong">
  <div>
    <Text>–£—Ä–æ–≤–µ–Ω—å {level}</Text>
    <div>‚ö° {energy} ‚≠ê {stars}</div>
    <ProgressBar value={xpIntoLevel} max={xpIntoLevel + xpToNextLevel} />
  </div>
  <div>
    <Button onClick={() => navigate('/exchange')}>–ú–∞–≥–∞–∑–∏–Ω</Button>
    <Button onClick={() => navigate('/earn')}>–ü—Ä–æ—Ñ–∏–ª—å</Button>
  </div>
</Surface>

–î—Ä—É–≥–∏–µ —ç–∫—Ä–∞–Ω—ã:
<Surface tone="overlayMedium" border="subtle">
  <Text variant="title">{activeTab}</Text>
  <Button onClick={() => navigate('/')}>–ù–∞ Tap</Button>
</Surface>

renderHeader:
const renderHeader = useCallback(({ activeTab }) => {
  if (activeTab === 'tap') return <TapScreenHeader />;
  return <SimpleHeader title={activeTab} />;
}, [energy, level, stars, xpIntoLevel]);

### –ê–Ω–∞–ª–∏–∑

- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.** Telegram –¥–æ–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –≤ top-area, –Ω–æ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–µ—Ç, —á—Ç–æ –≤ fullscreen –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –µ–¥–∏–Ω—ã–π UX –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏.
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è.** App.tsx —Ä–µ–Ω–¥–µ—Ä–∏—Ç –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ Surface –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –∏—Ö –ø–æ `activeTab` (`webapp/src/App.tsx:344-420`), –ø—Ä–∏ —ç—Ç–æ–º –æ–±–µ –≤–µ—Ä—Å–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–µ –∂–µ —Ç–æ–∫–µ–Ω—ã (`Surface`, `ProgressBar`). –° 2025‚Äë11‚Äë08 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–µ–π—Å—Ç–≤–∏–π/–∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –æ–ø–∏—Å–∞–Ω–∞ –≤ `webapp/src/constants/headerSchema.ts`, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –¥–æ–±–∞–≤–ª—è—Ç—å –≤–∫–ª–∞–¥–∫–∏ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ.
- **–í—ã–≤–æ–¥.** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è: –∫–æ–Ω—Ç–µ–Ω—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –æ—Ç layout, —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—ã–Ω–µ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ JSON/TS schema, —á—Ç–æ–±—ã –Ω–æ–≤—ã–µ –≤–∫–ª–∞–¥–∫–∏ –Ω–µ —Ç—Ä–µ–±–æ–≤–∞–ª–∏ JSX –ø—Ä–∞–≤–æ–∫.

### –ê–Ω–∞–ª–∏–∑

- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.** Telegram –¥–æ–ø—É—Å–∫–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç –≤ top-area, –Ω–æ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–µ—Ç, —á—Ç–æ –≤ fullscreen –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã –∏ –∂–µ–ª–∞—Ç–µ–ª—å–Ω–æ —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –µ–¥–∏–Ω—ã–π UX –º–µ–∂–¥—É –≤–∫–ª–∞–¥–∫–∞–º–∏.
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è.** App.tsx —Ä–µ–Ω–¥–µ—Ä–∏—Ç –¥–≤–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞ Surface –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç –∏—Ö –ø–æ `activeTab` (`webapp/src/App.tsx:344-420`), –ø—Ä–∏ —ç—Ç–æ–º –æ–±–µ –≤–µ—Ä—Å–∏–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Ç–µ –∂–µ —Ç–æ–∫–µ–Ω—ã (`Surface`, `ProgressBar`).
- **–í—ã–≤–æ–¥.** –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∞—è: –∫–æ–Ω—Ç–µ–Ω—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω –æ—Ç layout, —á—Ç–æ —É–ø—Ä–æ—â–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤—ã–Ω–µ—Å—Ç–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∑–∞–≥–æ–ª–æ–≤–∫–æ–≤ –≤ JSON/TS schema, —á—Ç–æ–±—ã –Ω–æ–≤—ã–µ –≤–∫–ª–∞–¥–∫–∏ –Ω–µ —Ç—Ä–µ–±–æ–≤–∞–ª–∏ JSX –ø—Ä–∞–≤–æ–∫.

---
3. CSS –¢–û–ö–ï–ù–´ –ò –ú–ê–¢–ï–ú–ê–¢–ò–ö–ê

:root {
  --tg-safe-area-inset-top: 44px;
  --tg-content-safe-area-inset-top: 24px;
  --safe-area-top: max(env(safe-area-inset-top), var(--tg-safe-area-inset-top));
  --content-safe-area-top: var(--tg-content-safe-area-inset-top);
  --app-content-base-top: calc(var(--safe-area-top) + var(--content-safe-area-top));
  --app-header-buffer: 12px;
  --app-header-offset-top: calc(var(--app-content-base-top) + var(--app-header-buffer));
  --app-header-reserve: 90px;
  --app-content-padding-top: calc(var(--app-content-base-top) + var(--app-header-reserve) + var(--app-header-buffer));
}

–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥ –æ—Ç Device Notch –¥–æ Main Content.

### –ê–Ω–∞–ª–∏–∑

- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.** Telegram –ø—Ä–µ–¥–ø–∏—Å—ã–≤–∞–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `safeAreaInsets` –∏ `contentSafeAreaInsets`, –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –ø—Ä–∏ –∫–∞–∂–¥–æ–º `safe_area_changed`. –ñ—ë—Å—Ç–∫–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ø—É—Å—Ç–∏–º—ã —Ç–æ–ª—å–∫–æ –∫–∞–∫ fallback.
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è.** `applySafeAreaCss` –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞–µ—Ç `--app-*` –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ dataset (`webapp/src/services/tma/viewport.ts:130-210`). –ú–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ `shared/tokens/safe-area.json`, –∫–æ—Ç–æ—Ä—ã–π –∏–º–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è –≤–µ–±-–∫–ª–∏–µ–Ω—Ç–æ–º (`webapp/src/constants/layout.ts`).
- **–í—ã–≤–æ–¥.** –§–æ—Ä–º—É–ª—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—Ç –æ—Ñ–¥–æ–∫—É; –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ª–∏—à—å –≤—ã–Ω–µ—Å—Ç–∏ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –≤ –æ–±—â–∏–µ –¥–∏–∑–∞–π–Ω-—Ç–æ–∫–µ–Ω—ã, —á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –º–µ–∂–¥—É CSS –∏ JS.

---
4. –ö–õ–Æ–ß–ï–í–´–ï –ö–û–ú–ü–û–ù–ï–ù–¢–´

Surface ‚Äî overlay, border, elevation, padding, rounded.
Text ‚Äî variants, tone, weight, transform.
Button ‚Äî variant, size, loading, success, –º–∏–∫—Ä–æ–∏–Ω—Ç–µ—Ä–∞–∫—Ü–∏–∏ (hover/tap/shake).
ProgressBar ‚Äî value/max, motion –∞–Ω–∏–º–∞—Ü–∏—è width.

### –ê–Ω–∞–ª–∏–∑

- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.** Telegram –Ω–µ –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç UI-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã, –Ω–æ –ø—Ä–æ—Å–∏—Ç, —á—Ç–æ–±—ã —ç–ª–µ–º–µ–Ω—Ç—ã –≤–µ—Ä—Ö–Ω–µ–π –∑–æ–Ω—ã –±—ã–ª–∏ –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–º–∏ –∏ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–ª–∏ –Ω–∞ theme tokens.
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è.** –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã `Surface`, `Text`, `Button`, `ProgressBar` –∏—Å–ø–æ–ª—å–∑—É—é—Ç –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ç–æ–∫–µ–Ω—ã (`bg-layer`, `text`, `accent`) –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∫–ª–∞—Å—Å—ã (tailwind). –û–Ω–∏ —É–∂–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞–Ω—ã —Å —Ç–µ–º–æ–π —á–µ—Ä–µ–∑ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è–º.
- **–í—ã–≤–æ–¥.** –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–Ω—ã–π —Å–ª–æ–π –æ–ø–∏—Å–∞–Ω –≤–µ—Ä–Ω–æ; –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, –∫—Ä–æ–º–µ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–æ–ø—Å–æ–≤ –≤ –¥–∏–∑–∞–π–Ω-—Å–∏—Å—Ç–µ–º–µ.

---
5. –°–û–°–¢–û–Ø–ù–ò–Ø –ò –ü–ï–†–ï–•–û–î–´

Fullscreen flow: –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí expand ‚Üí –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ safe area ‚Üí —Ä–µ–Ω–¥–µ—Ä header ‚Üí requestFullscreen ‚Üí data-fullscreen=true ‚Üí –≤—ã—Ö–æ–¥ ‚Üí –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Ä–∞–º–∫–∏.
Theme change flow: user toggles ‚Üí theme_change event ‚Üí useTheme ‚Üí setHeaderColor ‚Üí CSS –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è.

### –ê–Ω–∞–ª–∏–∑

- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.** Telegram –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å–æ–±—ã—Ç–∏—è `viewport_changed`, `safe_area_changed` –∏ –º–µ—Ç–æ–¥—ã `web_app_request_fullscreen`/`web_app_exit_fullscreen`, –∞ —Ç–∞–∫–∂–µ –ø–æ—Ç–æ–∫ `theme_changed`. –í—Å–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å graceful fallback, –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ.
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è.** `viewport.ts` –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ `viewport.state` + `Telegram.WebApp.onEvent` –∏ –ª–æ–≥–∏—Ä—É–µ—Ç –∫–∞–∂–¥–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ (`webapp/src/services/tma/viewport.ts:211-360`). Fullscreen –∑–∞–ø—Ä–æ—Å—ã –∏–¥—É—Ç —á–µ—Ä–µ–∑ SDK —Å fallback –Ω–∞ `postEvent` (`—Å—Ç—Ä. 360-460`). `useTheme` –∏ AppLayout —ç—Ñ—Ñ–µ–∫—Ç –æ–±–µ—Å–ø–µ—á–∏–≤–∞—é—Ç —Ü–µ–ø–æ—á–∫—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π (`webapp/src/hooks/useTheme.ts:1-45`, `webapp/src/components/layout/AppLayout.tsx:46-92`).
- **–í—ã–≤–æ–¥.** –ü–æ—Ç–æ–∫–∏ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ –∏ —Å fallback-–∞–º–∏. –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Äî –æ–±–≤—è–∑–∞—Ç—å `logViewportAction` —Ç–µ–ª–µ–º–µ—Ç—Ä–∏–µ–π, —á—Ç–æ–±—ã –≤–∏–¥–µ—Ç—å –æ—Ç–∫–∞–∑–∞–Ω–Ω—ã–µ fullscreen –∑–∞–ø—Ä–æ—Å—ã –≤ production.

---
6. –ü–†–û–ë–õ–ï–ú–ù–´–ï –ó–û–ù–´ –ò –†–ï–®–ï–ù–ò–Ø

1) –ú–µ—Ä—Ü–∞–Ω–∏–µ padding ‚Äî —Ä–µ—à–∞–µ—Ç—Å—è var(--app-header-offset-top).
2) –î–≤–æ–π–Ω–∞—è —Ä–∞–º–∫–∞ ‚Äî data-fullscreen true —É–±–∏—Ä–∞–µ—Ç border.
3) –ö–Ω–æ–ø–∫–∞ –∑–∞–∫—Ä—ã—Ç—å –Ω–∞ Desktop ‚Äî —É—Å–ª–æ–≤–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä manual close.

### –ê–Ω–∞–ª–∏–∑

- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.** Telegram –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–µ—Ç, —á—Ç–æ –≤ fullscreen –Ω–µ–ª—å–∑—è –æ—Å—Ç–∞–≤–ª—è—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ status bars —Å —Ä–∞–º–∫–∞–º–∏/—Ç–µ–Ω—å—é –∏ —á—Ç–æ UI –¥–æ–ª–∂–µ–Ω —É—á–∏—Ç—ã–≤–∞—Ç—å –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –∑–∞–∫—Ä—ã—Ç–∏—è.
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è.** –í—Å–µ —Ç—Ä–∏ –ø—Ä–æ–±–ª–µ–º—ã –∑–∞–∫—Ä—ã—Ç—ã: padding –∏–¥—ë—Ç —á–µ—Ä–µ–∑ CSS var (`webapp/src/components/layout/AppLayout.tsx:97-118`), –±–æ—Ä–¥–µ—Ä –æ—Ç–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ `data-fullscreen` (`webapp/src/index.css:160-186`), desktop –ø–æ–ª—É—á–∞–µ—Ç `manual-close-button` (`AppLayout.tsx:155-170`).
- **–í—ã–≤–æ–¥.** –†–µ—à–µ–Ω–∏—è –∞–¥–µ–∫–≤–∞—Ç–Ω—ã. –ò–∑ —Ä–∏—Å–∫–æ–≤ ‚Äî –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ e2e-—Ç–µ—Å—Ç–æ–≤, –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—é—â–∏—Ö, —á—Ç–æ –∫–ª–∞—Å—Å `status-bar-shell` –Ω–µ –∏–∑–º–µ–Ω—è—Ç —Å–ª—É—á–∞–π–Ω–æ.

---
7. –û–°–û–ë–ï–ù–ù–û–°–¢–ò –†–ï–ê–õ–ò–ó–ê–¶–ò–ò

–ü–ª—é—Å—ã: –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω–æ—Å—Ç—å, —Ä–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å, accessibility, performance, fallback.
–ú–∏–Ω—É—Å—ã/—É–ª—É—á—à–µ–Ω–∏—è: useMemo, —Å—Ç—Ä–æ–≥–∏–µ —Ç–∏–ø—ã —Ç–µ–º, —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è safe area, Playwright —Ç–µ—Å—Ç—ã, JSDoc.

### –ê–Ω–∞–ª–∏–∑

- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.** –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è Telegram –Ω–µ –Ω–∞–≤—è–∑—ã–≤–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—Ç–µ–∫, –Ω–æ –ø–æ–¥—á—ë—Ä–∫–∏–≤–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –∏ –±—ã—Å—Ç—Ä–æ–π —Ä–µ–∞–∫—Ü–∏–∏ –Ω–∞ viewport/theme —Å–æ–±—ã—Ç–∏—è. –û—Ç–¥–µ–ª—å–Ω–∞—è —Å–µ–∫—Ü–∏—è QA —Å–æ–≤–µ—Ç—É–µ—Ç –ø—Ä–æ–≥–æ–Ω—è—Ç—å fullscreen —Å—Ü–µ–Ω–∞—Ä–∏–∏ –Ω–∞ –≤—Å–µ—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞—Ö.
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è.** –í—Å–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–µ –ø–ª—é—Å—ã –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã –∫–æ–¥–æ–º (CSS-–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `viewport.ts`, hooks, AppLayout). –ò–∑ —É–ª—É—á—à–µ–Ω–∏–π –∫—Ä–∏—Ç–∏—á–Ω–µ–µ –≤—Å–µ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∞—è —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è –∏ e2e-—Ç–µ—Å—Ç—ã.
- **–í—ã–≤–æ–¥.** –†–∞–∑–¥–µ–ª –æ—Ç—Ä–∞–∂–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥ ‚Äî —Ñ–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å roadmap —É–ª—É—á—à–µ–Ω–∏–π (—Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è ‚Üí Playwright ‚Üí —Ç–∏–ø—ã —Ç–µ–º—ã).

---
8. –°–í–Ø–ó–¨ –° –î–†–£–ì–ò–ú–ò –°–ò–°–¢–ï–ú–ê–ú–ò

Status Bar —á–∏—Ç–∞–µ—Ç gameStore (energy/level/stars/xp), authStore (isAdmin), uiStore (theme snapshot), –∏ –≤—ã–∑—ã–≤–∞–µ—Ç react-router navigate.

### –ê–Ω–∞–ª–∏–∑

- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.** –¢–µ–ª–µ–≥—Ä–∞–º –Ω–µ —Ä–µ–≥–ª–∞–º–µ–Ω—Ç–∏—Ä—É–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å—Ç–æ—Ä–∞–∂–∏, –Ω–æ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç –¥–µ—Ä–∂–∞—Ç—å top-–±–∞—Ä –ª—ë–≥–∫–∏–º –∏ –Ω–µ –≤—ã–ø–æ–ª–Ω—è—Ç—å —Ç—è–∂—ë–ª—É—é –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É, —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å `viewport` –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è.** Header –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —á–µ—Ä–µ–∑ zustand —Å—Ç–æ—Ä—ã (`webapp/src/store/gameStore.ts`, `uiStore.ts`, `authStore.ts`) –∏ –≤—ã–∑—ã–≤–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞–≤–∏–≥–∞—Ü–∏—é (`react-router`). –¢—è–∂—ë–ª–∞—è –ª–æ–≥–∏–∫–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, —á—Ç–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º.
- **–í—ã–≤–æ–¥.** –°–≤—è–∑–∏ –æ—Ñ–æ—Ä–º–ª–µ–Ω—ã —á–∏—Å—Ç–æ; —Å—Ç–æ–∏—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä –ø–æ–ª–µ–π –∏–∑ gameStore), —á—Ç–æ–±—ã –±—É–¥—É—â–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–æ—Ä–∞ –Ω–µ –ª–æ–º–∞–ª–∏ header.

---
9. –ö–û–ù–°–¢–ê–ù–¢–´ –ò –ú–ê–ì–ò–ß–ï–°–ö–ò–ï –ß–ò–°–õ–ê

HEADER_RESERVE_PX = 90; HEADER_BUFFER_PX = 12; NAVIGATION_RESERVE_PX = 88; SIDE_PADDING_PX = 16 ‚Üí safeLeft + 16/ safeRight + 16; safeBottom + 88; —Ç–∏–ø–æ–≥—Ä–∞—Ñ–∏–∫–∞ –∏ —Ä–∞–¥–∏—É—Å—ã.

### –ê–Ω–∞–ª–∏–∑

- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.** Telegram —Å–æ–≤–µ—Ç—É–µ—Ç –∏–∑–±–µ–≥–∞—Ç—å –∂—ë—Å—Ç–∫–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π, –∫—Ä–æ–º–µ —Ç–µ—Ö, —á—Ç–æ —Å–≤—è–∑–∞–Ω—ã —Å –¥–∏–∑–∞–π–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è; –ª—é–±—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –¥–æ–ª–∂–Ω—ã –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç viewport API.
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è.** –í –ø—Ä–æ–µ–∫—Ç–µ –º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –ª–µ–∂–∞—Ç –≤ `webapp/src/constants/layout.ts:1-7` –∏ `AppLayout.tsx:97-132`. –û–Ω–∏ –æ—Ç—Ä–∞–∂–∞—é—Ç —Ä–µ–∞–ª—å–Ω—ã–π –¥–∏–∑–∞–π–Ω (–∫–∞–ø—Å—É–ª–∞ 90px, –±—É—Ñ–µ—Ä 12px). –°–∏—Å—Ç–µ–º–Ω—ã–µ —á–∞—Å—Ç–∏ (safe area) –±–µ—Ä—É—Ç—Å—è –∏–∑ CSS –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, —Ç–∞–∫ —á—Ç–æ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ –Ω–µ—Ç.
- **–í—ã–≤–æ–¥.** –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–æ–ø—É—Å—Ç–∏–º—ã, –Ω–æ –∏—Ö —Å—Ç–æ–∏—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å –¥–∏–∑–∞–π–Ω-—Ç–æ–∫–µ–Ω–∞–º–∏ –∏ —É–ø–æ–º–∏–Ω–∞—Ç—å –≤ –¥–æ–∫–µ (—á—Ç–æ —É–∂–µ —Å–¥–µ–ª–∞–Ω–æ) ‚Äî —Ç–æ–≥–¥–∞ –ª—é–±—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è UI –±—É–¥—É—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω—ã.

---
10. –†–ï–ó–Æ–ú–ï: –ö–ê–ö –í–°–Å –†–ê–ë–û–¢–ê–ï–¢

–ü–æ—à–∞–≥–æ–≤—ã–π flow: App.tsx ‚Üí renderHeader ‚Üí AppLayout ‚Üí header style ‚Üí CSS ‚Üí fullscreen –∞—Ç—Ä–∏–±—É—Ç—ã ‚Üí —Å–æ–±—ã—Ç–∏—è TMA.

---
üé® –í–ò–ó–£–ê–õ–¨–ù–ê–Ø –°–•–ï–ú–ê

App.tsx ‚Üí Surface header ‚Üí AppLayout (hooks) ‚Üí header shell ‚Üí index.css (border/blur, fullscreen variant).

---
–°–∏—Å—Ç–µ–º–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã React 18, Telegram Mini App SDK –∏ CSS-–±–∞–∑–∏—Ä–æ–≤–∞–Ω–Ω—É—é –∞–¥–∞–ø—Ç–∏–≤–Ω–æ—Å—Ç—å.

### –ê–Ω–∞–ª–∏–∑

- **–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è.** –¢–∞–∫–æ–π flow (SDK init ‚Üí viewport/theme –ø–æ–¥–ø–∏—Å–∫–∏ ‚Üí layout ‚Üí CSS) –ø–æ–≤—Ç–æ—Ä—è–µ—Ç best practices –∏–∑ –æ—Ñ–¥–æ–∫–∞.
- **–§–∞–∫—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è.** –û–ø–∏—Å–∞–Ω–Ω—ã–π pipeline –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω –∫–æ–¥–æ–º: `renderHeader` –≤ `webapp/src/App.tsx:344-420`, AppLayout (`‚Ä¶:23-193`), CSS (`webapp/src/index.css:120-190`), viewport/theme —Å–µ—Ä–≤–∏—Å—ã. –°—Ö–µ–º–∞ –ø–æ–º–æ–≥–∞–µ—Ç –æ–Ω–±–æ—Ä–¥–∏–Ω–≥—É.
- **–í—ã–≤–æ–¥.** –†–∞–∑–¥–µ–ª –º–æ–∂–Ω–æ —Å—á–∏—Ç–∞—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–º. –î–ª—è –ø–æ–ª–Ω–æ—Ç—ã —Å—Ç–æ–∏—Ç –¥–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫–∏ –Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ç–µ—Å—Ç—ã (–∫–æ–≥–¥–∞ –ø–æ—è–≤—è—Ç—Å—è) –∏ —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—é.

---
11. –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –û–ë–ù–û–í–õ–ï–ù–ò–Ø (2025-11-08)

- –¢–µ–ª–µ–º–µ—Ç—Ä–∏—è safe area / viewport / fullscreen: `webapp/src/services/tma/viewport.ts` —Ç–µ–ø–µ—Ä—å –¥–µ—Ä–≥–∞–µ—Ç `logClientEvent` –¥–ª—è —Å–æ–±—ã—Ç–∏–π `safe_area_changed`, `viewport_metrics_changed`, `viewport_action`, –ø–æ—ç—Ç–æ–º—É –º–æ–∂–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ –∏–Ω—Ü–∏–¥–µ–Ω—Ç—ã –Ω–∞ –ø—Ä–æ–¥–µ.
- –†–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã–π Playwright —Ç–µ—Å—Ç: `webapp/tests/qa/safe-area.spec.ts` –¥–æ–ø–æ–ª–Ω–µ–Ω –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ —Å—Ç–∏–ª–µ–π, —á—Ç–æ–±—ã –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏–µ —Ä–∞–º–∫–∏/—Ç–µ–Ω–∏/blur –≤ fullscreen –∏ –∏—Ö –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏–µ –≤ expanded —Ä–µ–∂–∏–º–µ.
- –¢–æ–∫–µ–Ω—ã layout: `webapp/src/constants/layout.ts` —Ö—Ä–∞–Ω–∏—Ç `SAFE_AREA_LAYOUT_TOKENS` –∏ `SAFE_AREA_CSS_VARIABLES`, AppLayout/viewport –∏—Å–ø–æ–ª—å–∑—É—é—Ç `SIDE_PADDING_PX` –∏ shared constants –≤–º–µ—Å—Ç–æ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —á–∏—Å–µ–ª.
- Grafana: –≤ `infra/grafana/dashboards/telegram-miniapp-product.json` –¥–æ–±–∞–≤–ª–µ–Ω —Ä—è–¥ **Safe Area & Fullscreen** (–ø–∞–Ω–µ–ª–∏ safe-area events, inset quantiles, fullscreen share, viewport actions) –¥–ª—è –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.
- Hook-—Ç–µ–ª–µ–º–µ—Ç—Ä–∏—è: `useSafeArea` –∏ `useTheme` –ø–∏—à—É—Ç —Å–æ–±—ã—Ç–∏—è `safe_area_hook_sample`/`theme_hook_update`, –∞ —Ç–∞–∫–∂–µ –ø–æ–ø–æ–ª–Ω—è—é—Ç `window.__safeAreaStats/__themeStats` –¥–ª—è QA.
- Fallback —Å—Ü–µ–Ω–∞—Ä–∏–π –±–µ–∑ Telegram SDK –ø–æ–∫—Ä—ã—Ç —Ç–µ—Å—Ç–æ–º (¬´graceful fallback without Telegram SDK¬ª) –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω –≤ —Ä–∞–∑–¥–µ–ª–µ 12.

## 12. Fallback –±–µ–∑ Telegram SDK

- **–ü–æ–≤–µ–¥–µ–Ω–∏–µ.** –ü—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ Telegram Mini App SDK (`window.Telegram` undefined) `services/tma/core.ts` —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ `failed`, `viewport.ts` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–µ—Ñ–æ–ª—Ç–Ω—ã–µ –∏–Ω—Å–µ—Ç—ã, –∞ AppLayout –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å header —Å `data-fullscreen="false"`.
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.** `webapp/tests/qa/safe-area.spec.ts` —Å–æ–¥–µ—Ä–∂–∏—Ç —Å—Ü–µ–Ω–∞—Ä–∏–π ¬´graceful fallback without Telegram SDK¬ª, –æ—Ç–∫–ª—é—á–∞—é—â–∏–π `window.Telegram` –∏ –ø—Ä–æ–≤–µ—Ä—è—é—â–∏–π, —á—Ç–æ —Å—Ç–∞—Ç—É—Å-–±–∞—Ä —Ä–µ–Ω–¥–µ—Ä–∏—Ç—Å—è –±–µ–∑ –∫—Ä–∞—à–µ–π.
- **–¢–æ–∫–µ–Ω—ã.** Safe-area –∑–Ω–∞—á–µ–Ω–∏—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ `shared/tokens/safe-area.json`, –ø–æ—ç—Ç–æ–º—É –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏ –≤–µ–±-–∫–ª–∏–µ–Ω—Ç –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã.
