–ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó –ü–õ–ê–ù–ê –ú–ò–ì–†–ê–¶–ò–ò –ù–ê @tma.js/sdk-react

> –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ 2025-11-08: —Ñ–∏–Ω–∞–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ ‚Äî –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –Ω–∞ –ª–∏–Ω–µ–π–∫–µ `@tma.js/*`. –£–ø–æ–º–∏–Ω–∞–Ω–∏—è `@telegram-apps/*` –Ω–∏–∂–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã —Ç–æ–ª—å–∫–æ –∫–∞–∫ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–∫—Å—Ç.

  üîç EXECUTIVE SUMMARY

  –í–∞—à –ø–ª–∞–Ω —Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏ –≤–µ—Ä–Ω—ã–π, —Ö–æ—Ä–æ—à–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω –∏ —É—á–∏—Ç—ã–≤–∞–µ—Ç –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω—É—é –º–∏–≥—Ä–∞—Ü–∏—é. –û–¥–Ω–∞–∫–æ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–µ–ª–æ–≤
   –∏ —Ä–∏—Å–∫–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ —É—á–µ—Å—Ç—å.

  –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: ‚ö†Ô∏è 7/10 ‚Äî –ø–ª–∞–Ω —Ö–æ—Ä–æ—à–∏–π, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –≤ –¥–µ—Ç–∞–ª—è—Ö.

  ---
  ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û –ü–†–ê–í–ò–õ–¨–ù–û

  1. –ü–æ—ç—Ç–∞–ø–Ω—ã–π –ø–æ–¥—Ö–æ–¥ ‚Äî –∏–∑–±–µ–≥–∞–µ—Ç "big bang" –º–∏–≥—Ä–∞—Ü–∏–∏
  2. –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏–π ‚Äî —Ñ–∏–∫—Å–∞—Ü–∏—è —Ü–µ–ª–µ–≤–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
  3. –£—á—ë—Ç –¥–µ–≥—Ä–∞–¥–∞—Ü–∏–∏ ‚Äî fallback –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ Telegram
  4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–∫–æ–≤ –≤–º–µ—Å—Ç–æ —É–¥–∞–ª–µ–Ω–∏—è
  5. –î–µ–∫–æ–º–∏—Å—Å–∏—è legacy ‚Äî —Ñ–∏–Ω–∞–ª—å–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏

  ---
  ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ –ò –ü–†–û–ë–ï–õ–´

  üö® 1. –ù–ï–ü–û–õ–ù–ê–Ø –ò–ù–§–û–†–ú–ê–¶–ò–Ø –û @tma.js/sdk-react

  –ü—Ä–æ–±–ª–µ–º–∞:
  - –í—ã —É–ø–æ–º–∏–Ω–∞–µ—Ç–µ —Ö—É–∫–∏ useViewport, useThemeParams, useMainButton, useBackButton, useSafeArea, –ù–û —ç—Ç–∏ —Ö—É–∫–∏ –Ω–µ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤
  –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ @tma.js/sdk-react
  - –°–æ–≥–ª–∞—Å–Ω–æ –º–æ–µ–º—É –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—é, @tma.js/sdk-react –ù–ï –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –≥–æ—Ç–æ–≤—ã—Ö —Ö—É–∫–æ–≤ –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ SDK
  - –†–µ–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ö—É–∫–∏: useLaunchParams, useRawInitData, useSignal, useAndroidDeviceData

  –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
  // ‚ùå –í–µ—Ä–æ—è—Ç–Ω–æ –ù–ï —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
  import { useViewport, useThemeParams, useSafeArea } from '@tma.js/sdk-react';

  // ‚úÖ –†–µ–∞–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç:
  import { useLaunchParams, useRawInitData, useSignal } from '@tma.js/sdk-react';
  import { viewport, themeParams, miniApp } from '@tma.js/sdk'; // SDK –Ω–∞–ø—Ä—è–º—É—é

  –î–µ–π—Å—Ç–≤–∏—è:
  1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π —ç–∫—Å–ø–æ—Ä—Ç @tma.js/sdk-react@3.0.8 –ª–æ–∫–∞–ª—å–Ω–æ
  2. –í–æ–∑–º–æ–∂–Ω–æ, –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ React-–æ–±—ë—Ä—Ç–∫–∏ —á–µ—Ä–µ–∑ useSignal + SDK entities
  3. –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É: –ø–∞–∫–µ—Ç @telegram-apps/sdk-react (–¥—Ä—É–≥–æ–π –ø—Ä–æ–µ–∫—Ç, –Ω–æ –±–æ–ª–µ–µ –ø–æ–ª–Ω–∞—è React –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è)

  ---
  üö® 2. –û–¢–°–£–¢–°–¢–í–ò–ï –°–¢–†–ê–¢–ï–ì–ò–ò –î–õ–Ø SDKProvider

  –ü—Ä–æ–±–ª–µ–º–∞:
  - –ü–ª–∞–Ω —É–ø–æ–º–∏–Ω–∞–µ—Ç SDKProvider, –Ω–æ –Ω–µ –¥–µ—Ç–∞–ª–∏–∑–∏—Ä—É–µ—Ç:
    - –ì–¥–µ –∏–º–µ–Ω–Ω–æ –µ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∏—Ç—å (main.tsx –∏–ª–∏ App.tsx)?
    - –ö–∞–∫ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã init, acceptCustomStyles, debug?
    - –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—à–∏–±–∫–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏?

  –¢–µ–∫—É—â–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (services/tma/core.ts:42-76):
  cleanup = init();
  themeParams.mount();
  miniApp.mount();
  viewport.mount();
  swipeBehavior.mount();
  miniApp.ready();
  viewport.expand();
  swipeBehavior.disableVertical();

  –í–æ–ø—Ä–æ—Å: –ö—Ç–æ –±—É–¥–µ—Ç –¥–µ–ª–∞—Ç—å mount() –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ ‚Äî –ø—Ä–æ–≤–∞–π–¥–µ—Ä –∏–ª–∏ –≤—ã –≤—Ä—É—á–Ω—É—é?

  –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
  –î–æ–±–∞–≤—å—Ç–µ –≤ —à–∞–≥ 3 –¥–µ—Ç–∞–ª—å–Ω—É—é —Å–µ–∫—Ü–∏—é:
  ### 3.1. SDKProvider Configuration Blueprint

  ```typescript
  // webapp/src/components/providers/TmaSdkProvider.tsx
  import { SDKProvider } from '@tma.js/sdk-react';
  import { init, miniApp, viewport, swipeBehavior, themeParams } from '@tma.js/sdk';

  export function TmaSdkProvider({ children }: { children: ReactNode }) {
    useEffect(() => {
      const cleanup = init();
      themeParams.mount();
      miniApp.mount();
      viewport.mount();
      swipeBehavior.mount();

      miniApp.ready();
      viewport.expand();
      swipeBehavior.disableVertical();

      return cleanup;
    }, []);

    return <>{children}</>;
  }

  –ò–õ–ò –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ SDKProvider –Ω–∞–ø—Ä—è–º—É—é (–µ—Å–ª–∏ –æ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é):
  <SDKProvider debug={import.meta.env.DEV} acceptCustomStyles>
    <App />
  </SDKProvider>

  ---

  ### üö® **3. –ù–ï–Ø–°–ù–û–°–¢–¨ –° –ê–î–ê–ü–¢–ï–†–ù–´–ú –°–õ–û–ï–ú**

  **–ü—Ä–æ–±–ª–µ–º–∞:**
  - –®–∞–≥ 4: "useSafeArea/services/tma/viewport ‚Üí –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è useViewport/useViewportState"
  - –®–∞–≥ 5: "services/tma/haptics ‚Üí useHapticFeedback"

  **–ù–û:** –ï—Å–ª–∏ @tma.js/sdk-react –ù–ï –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —ç—Ç–∏ —Ö—É–∫–∏, –≤–∞–º –Ω—É–∂–Ω–æ –±—É–¥–µ—Ç:
  1. –°–æ–∑–¥–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –æ–±—ë—Ä—Ç–∫–∏
  2. –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SDK –Ω–∞–ø—Ä—è–º—É—é –≤–Ω—É—Ç—Ä–∏ —Ö—É–∫–æ–≤

  **–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è useSafeArea:**
  ```typescript
  // webapp/src/hooks/useSafeArea.ts
  const safeArea = useSyncExternalStore(
    subscribeSafeArea,    // –ü–æ–¥–ø–∏—Å–∫–∞ —á–µ—Ä–µ–∑ services/tma/viewport
    getSafeAreaSnapshot,
    getSafeAreaSnapshot
  );

  –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –ù–ï–¢ –≥–æ—Ç–æ–≤–æ–≥–æ useViewport):
  // –í–∞—Ä–∏–∞–Ω—Ç 1: –°–æ–∑–¥–∞—Ç—å —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π —Ö—É–∫
  export function useSafeArea() {
    const [safeArea, setSafeArea] = useState(viewport.safeAreaInsets());

    useEffect(() => {
      const unsub = viewport.state.sub(() => {
        setSafeArea(viewport.safeAreaInsets());
      });
      return unsub;
    }, []);

    return safeArea;
  }

  // –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å useSignal (–µ—Å–ª–∏ –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —Å viewport.state)
  import { useSignal } from '@tma.js/sdk-react';
  export function useSafeArea() {
    return useSignal(viewport.state, () => viewport.safeAreaInsets());
  }

  –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
  –î–æ–±–∞–≤—å—Ç–µ —Ä–∞–∑–¥–µ–ª "–°—Ç—Ä–∞—Ç–µ–≥–∏—è –∞–¥–∞–ø—Ç–µ—Ä–Ω–æ–≥–æ —Å–ª–æ—è" —Å –ø—Ä–∏–º–µ—Ä–∞–º–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞–∂–¥–æ–≥–æ —Ö—É–∫–∞.

  ---
  üö® 4. –°–ò–ù–•–†–û–ù–ù–´–ï –í–´–ó–û–í–´ –ò–ó STORES

  –ü—Ä–æ–±–ª–µ–º–∞ (–®–∞–≥ 6):
  "–î–ª—è —Å—Ç–æ—Ä–æ–≤, –≥–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ API (–Ω–∞–ø—Ä–∏–º–µ—Ä, triggerTmaHapticImpact), –¥–æ–±–∞–≤–∏—Ç—å —Ç–æ–Ω–∫–∏–π —Å–ª–æ–π, —á—Ç–æ–±—ã —Ö—Ä–∞–Ω–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞
  —Ç–µ–∫—É—â–∏–π hook API"

  –ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–¥–∞:
  // webapp/src/hooks/useHaptic.ts –ù–ï –∏—Å–ø–æ–ª—å–∑—É–µ—Ç TMA haptics!
  // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç navigator.vibrate()

  // –†–µ–∞–ª—å–Ω—ã–π TMA haptics:
  // webapp/src/services/tma/haptics.ts
  export function triggerTmaHapticImpact(style: ImpactHapticFeedbackStyle = 'light'): void {
    hapticFeedback.impactOccurred(style);
  }

  –ì–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è:
  # –ù–∞–π–¥–µ–Ω–æ –≤ 0 —Ñ–∞–π–ª–æ–≤ —á–µ—Ä–µ–∑ Grep —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
  # –≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ TMA haptics –°–ï–ô–ß–ê–° –ù–ï –ò–°–ü–û–õ–¨–ó–£–Æ–¢–°–Ø –≤ —Å—Ç–æ—Ä–∞—Ö!

  –í—ã–≤–æ–¥: –≠—Ç–æ—Ç –ø—É–Ω–∫—Ç –ø–ª–∞–Ω–∞ –∏–∑–±—ã—Ç–æ—á–µ–Ω –¥–ª—è —Ç–µ–∫—É—â–µ–π –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã. Haptics –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ useHaptic hook (navigator.vibrate),
   –∞ –Ω–µ —á–µ—Ä–µ–∑ TMA SDK.

  –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
  - –£–±–µ—Ä–∏—Ç–µ —ç—Ç–æ—Ç –ø—É–Ω–∫—Ç –∏–∑ –ø–ª–∞–Ω–∞
  - –ò–õ–ò –¥–æ–±–∞–≤—å—Ç–µ –∑–∞–¥–∞—á—É "–ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Å navigator.vibrate –Ω–∞ TMA HapticFeedback"

  ---
  üö® 5. –¢–ï–°–¢–´ –ò –ú–û–ö–ò

  –ü—Ä–æ–±–ª–µ–º–∞ (–®–∞–≥ 7):
  "–û–±–Ω–æ–≤–∏—Ç—å Playwright –º–æ–∫ (setupStageMocks) —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω –º–æ–≥ –ø–æ–¥–º–µ–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ overrides
  –∏–ª–∏ SDKProvider –≤ —Ä–µ–∂–∏–º–µ mock)"

  –¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–∫–æ–≤ (webapp/tests/utils/stageMocks.ts:334-340):
  if (initialSafeArea) {
    window.__safeAreaOverride = initialSafeArea;
  }
  if (initialViewport) {
    window.__viewportMetricsOverride = initialViewport;
  }

  –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã —ç—Ç–∏ window.__*Override –º–æ–≥—É—Ç –Ω–µ —Ä–∞–±–æ—Ç–∞—Ç—å, –µ—Å–ª–∏ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ.

  –†–µ—à–µ–Ω–∏–µ:
  1. –û–ø—Ü–∏—è A: –°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Ä—É—á–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É overrides –≤ –Ω–æ–≤–æ–º –∫–æ–¥–µ (–∫–∞–∫ —Å–µ–π—á–∞—Å –≤ viewport.ts:76-109)
  2. –û–ø—Ü–∏—è B: –°–æ–∑–¥–∞—Ç—å MockSDKProvider –¥–ª—è —Ç–µ—Å—Ç–æ–≤
  3. –û–ø—Ü–∏—è C: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å vi.mock() (Vitest) –∏–ª–∏ jest.mock() –¥–ª—è –ø–æ–¥–º–µ–Ω—ã SDK

  –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
  –î–æ–±–∞–≤—å—Ç–µ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –º–æ–∫–æ–≤:
  // webapp/tests/utils/MockSDKProvider.tsx
  export function MockSDKProvider({ children, overrides }: Props) {
    useEffect(() => {
      if (overrides.safeArea) {
        window.__safeAreaOverride = overrides.safeArea;
      }
      if (overrides.viewport) {
        window.__viewportMetricsOverride = overrides.viewport;
      }
    }, [overrides]);

    return <TmaSdkProvider>{children}</TmaSdkProvider>;
  }

  ---
  üö® 6. –ü–û–¢–†–ï–ë–ò–¢–ï–õ–ò SERVICES/TMA/

  –ü—Ä–æ–±–ª–µ–º–∞ (–®–∞–≥ 1):
  –ü–ª–∞–Ω —É–ø–æ–º–∏–Ω–∞–µ—Ç —Å–æ—Å—Ç–∞–≤–∏—Ç—å –∫–∞—Ä—Ç—É –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π, –Ω–æ —è –£–ñ–ï –ü–†–û–ê–ù–ê–õ–ò–ó–ò–†–û–í–ê–õ —ç—Ç–æ –∑–∞ –≤–∞—Å:

  –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ services/tma/*:
  ‚úÖ –ù–∞–π–¥–µ–Ω–æ 10 —Ñ–∞–π–ª–æ–≤:
  1. webapp/src/hooks/useTheme.ts           ‚Üí theme.ts
  2. webapp/src/hooks/useSafeArea.ts        ‚Üí viewport.ts
  3. webapp/src/main.tsx                    ‚Üí core, viewport, theme
  4. webapp/src/store/gameStore.ts          ‚Üí (–Ω–µ –Ω–∞–π–¥–µ–Ω–æ –ø—Ä—è–º—ã—Ö –∏–º–ø–æ—Ä—Ç–æ–≤)
  5. webapp/src/hooks/useTelegramMainButton.ts ‚Üí mainButton.ts
  6. webapp/src/hooks/useGyroscope.ts       ‚Üí (–Ω–µ –Ω–∞–π–¥–µ–Ω–æ TMA, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–π)
  7. webapp/src/hooks/useAuthBootstrap.ts   ‚Üí initData.ts (–≤–µ—Ä–æ—è—Ç–Ω–æ)
  8. webapp/src/services/cosmetics.ts       ‚Üí (–Ω–µ –Ω–∞–π–¥–µ–Ω–æ)
  9. webapp/src/services/preferencesSync.ts ‚Üí cloudStorage.ts
  10. webapp/src/hooks/useTelegramBackButton.ts ‚Üí backButton.ts

  –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:
  –ó–∞–º–µ–Ω–∏—Ç–µ —à–∞–≥ 1 –Ω–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:

  | –¢–µ–∫—É—â–∏–π —Ñ–∞–π–ª             | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç service             | –¶–µ–ª–µ–≤–æ–π —Ö—É–∫/–ø—Ä–æ–≤–∞–π–¥–µ—Ä       |
  |--------------------------|--------------------------------|-----------------------------|
  | useSafeArea.ts           | viewport.ts                    | useViewport (—Å–æ–∑–¥–∞—Ç—å)       |
  | useTheme.ts              | theme.ts                       | useThemeParams + useMiniApp |
  | useTelegramMainButton.ts | mainButton.ts                  | useMainButton (—Å–æ–∑–¥–∞—Ç—å)     |
  | useTelegramBackButton.ts | backButton.ts                  | useBackButton (—Å–æ–∑–¥–∞—Ç—å)     |
  | preferencesSync.ts       | cloudStorage.ts                | useCloudStorage (—Å–æ–∑–¥–∞—Ç—å)   |
  | main.tsx                 | core.ts, viewport.ts, theme.ts | TmaSdkProvider              |

  ---
  üö® 7. MOTION SERVICE –ü–†–û–ü–£–©–ï–ù

  –û–±–Ω–∞—Ä—É–∂–µ–Ω–æ:
  // webapp/src/services/tma/motion.ts —Å—É—â–µ—Å—Ç–≤—É–µ—Ç!
  // –ù–æ –≤ –ø–ª–∞–Ω–µ –ù–ï –£–ü–û–ú–ò–ù–ê–ï–¢–°–Ø

  –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ª–∏ –æ–Ω:
  # –î–æ–±–∞–≤—å—Ç–µ –≤ –∏–Ω–≤–µ–Ω—Ç–∞—Ä–∏–∑–∞—Ü–∏—é (–®–∞–≥ 1)

  ---
  üìã –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

  1. –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ê: @telegram-apps/sdk-react

  –†–∞—Å—Å–º–æ—Ç—Ä–∏—Ç–µ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ @telegram-apps/sdk-react –≤–º–µ—Å—Ç–æ @tma.js/sdk-react:
  - –ë–æ–ª–µ–µ –ø–æ–ª–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
  - –ì–æ—Ç–æ–≤—ã–µ —Ö—É–∫–∏: useViewport, useBackButton, useThemeParams, ...
  - –ê–∫—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

  –°—Ä–∞–≤–Ω–µ–Ω–∏–µ:
  | –ü–∞–∫–µ—Ç                    | –•—É–∫–∏                                            | –ü—Ä–æ–≤–∞–π–¥–µ—Ä—ã       | –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è |
  |--------------------------|-------------------------------------------------|------------------|--------------|
  | @tma.js/sdk-react        | useLaunchParams, useRawInitData, useSignal      | SDKProvider      | ‚ö†Ô∏è –°–∫—É–¥–Ω–∞—è   |
  | @telegram-apps/sdk-react | useViewport, useBackButton, useThemeParams, ... | TelegramProvider | ‚úÖ –ü–æ–ª–Ω–∞—è     |

  ---
  2. –†–ò–°–ö: –í–ï–†–°–ò–Ø SDK

  –¢–µ–∫—É—â–∏–π @tma.js/sdk-react@3.0.8 –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º —Å @tma.js/sdk –∏–∑-–∑–∞ peer dependencies.

  –ü—Ä–æ–≤–µ—Ä—å—Ç–µ:
  cd webapp
  npm ls @tma.js/sdk @tma.js/sdk-react

  ---
  3. –û–¢–°–£–¢–°–¢–í–ò–ï ROLLBACK –ü–õ–ê–ù–ê

  –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –ø—Ä–æ–≤–∞–ª–∏—Ç—Å—è –Ω–∞ production?

  –î–æ–±–∞–≤—å—Ç–µ —à–∞–≥ 9:
  9. Rollback Strategy
     - Feature flag –¥–ª—è –≤–∫–ª—é—á–µ–Ω–∏—è/–≤—ã–∫–ª—é—á–µ–Ω–∏—è –Ω–æ–≤—ã—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
     - –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ legacy –∫–æ–¥–∞ –¥–æ –ø–æ–ª–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ (1-2 —Ä–µ–ª–∏–∑–∞)
     - –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

  ---
  4. –¢–ï–õ–ï–ú–ï–¢–†–ò–Ø –ú–ò–ì–†–ê–¶–ò–ò

  –î–æ–±–∞–≤—å—Ç–µ —Å–æ–±—ã—Ç–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ—Å—Ç–∏ –º–∏–≥—Ä–∞—Ü–∏–∏:
  logClientEvent('sdk_provider_init', { status: 'success' | 'failed' });
  logClientEvent('legacy_viewport_fallback_used', { reason: '...' });

  ---
  üéØ –ò–¢–û–ì–û–í–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

  ‚úÖ –ß—Ç–æ —Å–¥–µ–ª–∞—Ç—å –ü–ï–†–ï–î –Ω–∞—á–∞–ª–æ–º –º–∏–≥—Ä–∞—Ü–∏–∏:

  1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–∏–π API @tma.js/sdk-react@3.0.8
  cd webapp
  node -e "console.log(Object.keys(require('@tma.js/sdk-react')))"
  2. –°–æ–∑–¥–∞—Ç—å PoC (Proof of Concept) –æ–¥–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞:
    - –ú–∏–≥—Ä–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ useTheme ‚Üí –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç
    - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –ø—Ä–æ–≤–∞–π–¥–µ—Ä –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
  3. –û—Ü–µ–Ω–∏—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—É @telegram-apps/sdk-react
    - –°—Ä–∞–≤–Ω–∏—Ç—å API –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
    - –ü—Ä–∏–Ω—è—Ç—å –æ–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ, –∫–∞–∫–æ–π –ø–∞–∫–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
  4. –î–æ–ø–æ–ª–Ω–∏—Ç—å –ø–ª–∞–Ω:
    - –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É TmaSdkProvider
    - –î–æ–±–∞–≤–∏—Ç—å —Ç–∞–±–ª–∏—Ü—É –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (–∏–∑ –º–æ–µ–≥–æ –∞–Ω–∞–ª–∏–∑–∞ –≤—ã—à–µ)
    - –î–æ–±–∞–≤–∏—Ç—å rollback —Å—Ç—Ä–∞—Ç–µ–≥–∏—é
    - –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–ª–µ–º–µ—Ç—Ä–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏

  ---
  ‚ö†Ô∏è –ö—Ä–∞—Å–Ω—ã–µ —Ñ–ª–∞–≥–∏:

  - ‚ùå –ù–µ—Ç —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏, —á—Ç–æ –≤—Å–µ –Ω—É–∂–Ω—ã–µ —Ö—É–∫–∏ —Å—É—â–µ—Å—Ç–≤—É—é—Ç –≤ @tma.js/sdk-react
  - ‚ùå –ù–µ—Ç –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ –¥–ª—è SDKProvider
  - ‚ùå –ù–µ—Ç rollback —Å—Ç—Ä–∞—Ç–µ–≥–∏–∏
  - ‚ùå –ü—É–Ω–∫—Ç –ø—Ä–æ haptics –≤ —Å—Ç–æ—Ä–∞—Ö ‚Äî –∏–∑–±—ã—Ç–æ—á–µ–Ω
  - ‚ùå motion.ts –ø—Ä–æ–ø—É—â–µ–Ω –≤ –∞–Ω–∞–ª–∏–∑–µ

  ---
  ‚úÖ –ó–µ–ª—ë–Ω—ã–µ —Ñ–ª–∞–≥–∏:

  - ‚úÖ –ü–æ—ç—Ç–∞–ø–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è
  - ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ fallback –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤
  - ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
  - ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ—à–µ–Ω–∏–π

  ---
  üìù –§–ò–ù–ê–õ–¨–ù–ê–Ø –û–¶–ï–ù–ö–ê –ü–õ–ê–ù–ê

  | –ö—Ä–∏—Ç–µ—Ä–∏–π               | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π                      |
  |------------------------|--------|----------------------------------|
  | –°—Ç—Ä—É–∫—Ç—É—Ä–∞              | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê  | –û—Ç–ª–∏—á–Ω–∞—è –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –Ω–∞ 8 —à–∞–≥–æ–≤ |
  | –î–µ—Ç–∞–ª—å–Ω–æ—Å—Ç—å            | ‚≠ê‚≠ê‚≠ê    | –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏ –ø–æ API     |
  | –†–∏—Å–∫-–º–µ–Ω–µ–¥–∂–º–µ–Ω—Ç        | ‚≠ê‚≠ê     | –ù–µ—Ç rollback –ø–ª–∞–Ω–∞               |
  | –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ           | ‚≠ê‚≠ê‚≠ê‚≠ê   | –£—á—Ç–µ–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–æ–∫–æ–≤          |
  | –û–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å | ‚≠ê‚≠ê‚≠ê‚≠ê   | Fallback –º–µ—Ö–∞–Ω–∏–∑–º—ã –ø—Ä–µ–¥—É—Å–º–æ—Ç—Ä–µ–Ω—ã |

  –ò–¢–û–ì–û: 7/10 ‚Äî —Ö–æ—Ä–æ—à–∏–π —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç, —Ç—Ä–µ–±—É–µ—Ç –¥–æ—Ä–∞–±–æ—Ç–∫–∏ –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏–µ–º.
